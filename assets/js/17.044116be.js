(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{336:function(s,a,t){"use strict";t.r(a);var n=t(3),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"关于aws-s3-数据库备份记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于aws-s3-数据库备份记录"}},[s._v("#")]),s._v(" 关于aws s3 数据库备份记录")]),s._v(" "),a("p",[s._v("最近需要使用mysql备份数据库，防止突发情况。\n传统的备份一般都是直接备份到本机，或者其他地方，但是都是有点欠妥。比如那天服务器挂掉了，起不来了，传统数据库备份没有卵用。找了很多个备份服务器的，阿里云，腾讯云，亚马逊。为啥选择亚马逊，一是工作需要，而是真的很安全，阿里腾讯外围端口是全部开放的，亚马逊则是你开那个才有默认是全部关闭的。")]),s._v(" "),a("h2",{attrs:{id:"安装aws-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装aws-cli"}},[s._v("#")]),s._v(" 安装aws cli")]),s._v(" "),a("h3",{attrs:{id:"windows下安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows下安装"}},[s._v("#")]),s._v(" windows下安装")]),s._v(" "),a("p",[s._v("本机使用的是win7")]),s._v(" "),a("h4",{attrs:{id:"首先检查现有python版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#首先检查现有python版本"}},[s._v("#")]),s._v(" 首先检查现有python版本")]),s._v(" "),a("p",[s._v("快捷键"),a("code",[s._v("win+R")]),s._v(",输入"),a("code",[s._v("cmd")]),s._v("确定；打开cmd命令行输入"),a("code",[s._v("python -V")]),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/trhsy/PicGo/img/aws-pythin-v.png",alt:"aws-pythin-v.png"}}),s._v("\n若小于2.7.9，请自行更新pythonb版本，cli官网上瞄到一眼说最低支持版本2.7.9，没研究之前版本会有什么问题，但是为了方便还是按要求来吧。")]),s._v(" "),a("h4",{attrs:{id:"安装python-pip-安装aws-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装python-pip-安装aws-cli"}},[s._v("#")]),s._v(" 安装python pip 安装aws cli")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.python.org/downloads/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载python"),a("OutboundLink")],1),s._v(",你可以下载最新的，但是等下安装pip的时候一定要根据安装的版本来。\n安装完了之后需要配置环境变量，就是把你安装python的路径配置到path;具体操作，我的电脑-右键-属性-高级系统设置-环境变量-系统变量，找到path,编辑在最后填上"),a("code",[s._v("D:\\Python27;D:\\Python27\\Scripts")]),s._v("这是我的，你可以替换成你的安装路径。\n接着再次打开cmd输入"),a("code",[s._v("path")]),s._v("查看是否配置成功，再次检查python版本"),a("code",[s._v("python -V")]),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/trhsy/PicGo/img/aws-python.png",alt:"aws-python.png"}}),s._v("\npython安装完毕后需要安装pip，下载地址："),a("a",{attrs:{href:"https://pypi.python.org/pypi/pip#downloads",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://pypi.python.org/pypi/pip#downloads"),a("OutboundLink")],1),s._v("\n下载完成之后，解压到一个文件夹，用CMD控制台进入解压目录，输入\n"),a("code",[s._v("python setup.py install")]),s._v("\n正确安装完成之后需要加入path成为内部命令，将python目录下的scripts文件夹放入path中；就是上文中提到的环境配置。\n输入"),a("code",[s._v("pip")]),s._v("测试是否正常\n"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/trhsy/PicGo/img/aws-pip.png",alt:"aws-pip"}}),s._v("\n接着使用pip 安装awscli\n输入"),a("code",[s._v("pip install awscli")]),s._v(" 等待安装完毕；输入"),a("code",[s._v("aws --version")]),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/trhsy/PicGo/img/aws-v.png",alt:"aws-v"}})]),s._v(" "),a("h4",{attrs:{id:"下载及安装-msi-installer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载及安装-msi-installer"}},[s._v("#")]),s._v(" 下载及安装 MSI installer")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://s3.amazonaws.com/aws-cli/AWSCLI64.msi",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://s3.amazonaws.com/aws-cli/AWSCLI64.msi"),a("OutboundLink")],1),s._v("\n下载后直接运行，一路下一步（如果想更改安装位置的话，可以手动修改）\n安装完成cmd输入"),a("code",[s._v("aws --version")]),s._v(" "),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/trhsy/PicGo/img/aws-v.png",alt:"aws-v"}})]),s._v(" "),a("h3",{attrs:{id:"linux下安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux下安装"}},[s._v("#")]),s._v(" linux下安装")]),s._v(" "),a("p",[s._v("本机使用 linux ubuntu")]),s._v(" "),a("h4",{attrs:{id:"检查安装python"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查安装python"}},[s._v("#")]),s._v(" 检查安装python")]),s._v(" "),a("p",[s._v("查看当前版本，我这个是更新过的，原来的版本2.7.4有点低，达不到要求害老夫一顿好整，哎")]),s._v(" "),a("div",{staticClass:"language-linux line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("root@fyb:~t# python -V\nPython 3.4.3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("还原一下原本的更新过程：")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("# 查看现有python版本\npython -V\n# 若小于2.7.9,卸载当前版本\napt-get remove --auto-remove python\n#更新源\nsudo apt-get update\n# 指定当前安装版本\nsudo add-apt-repository ppa:jonathonf/python-3.6\n# 安装python\nsudo apt-get install python3.6\n# 安装pip\nsudo apt-get install python3-pip\n# 更新pip\nsudo pip install --upgrade pip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("中间可能会出现一点问题，具体什么问题遇到找度娘，老夫这里不能重现了，已经折腾了一次了不想再被搞一次。")]),s._v(" "),a("h4",{attrs:{id:"从pip安装awscli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从pip安装awscli"}},[s._v("#")]),s._v(" 从pip安装awscli")]),s._v(" "),a("p",[s._v("输入"),a("code",[s._v("pip install awscli")]),s._v("，等待安装完成查看版本"),a("code",[s._v("aws --version")])]),s._v(" "),a("h3",{attrs:{id:"配置awscli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置awscli"}},[s._v("#")]),s._v(" 配置awscli")]),s._v(" "),a("p",[s._v("通过aws configure命令来进行配置\n至少提供访问密钥ID和秘密访问密钥，这将使用你的帐户创建一个带有~/.aws的文件夹（windows下应该在"),a("code",[s._v("C:\\Users\\Administrator\\.aws")]),s._v("）")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v(" aws configure\n Access key ID:your_key_ID\n Secret access key:your_access_key\n Default region name:your_region_name\n Default output format:可忽略(默认json)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("aws cli常用命令")]),s._v(" "),a("div",{staticClass:"language-cli line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" # 创建桶\n aws s3 mb s3://your_aws_name\n # 查看桶\n aws s3 ls\n # 查看桶信息\n aws s3 ls s3://your_aws_name\n # 删除桶\n aws s3 rb s3://your_aws_name\n # 本地上传s3服务器\n aws s3 cp file.xml s3://your_aws_name\n # s3服务器下载本地\n aws s3 cp s3://your_aws_name ./\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"shell-脚本备份mysql并上传到s3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shell-脚本备份mysql并上传到s3"}},[s._v("#")]),s._v(" shell 脚本备份mysql并上传到s3")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this mysql backups")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"you-db-user"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"you-db-password"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"you-host"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("date_format")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%a"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("db_dir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/fyb_test/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest_backup_file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/fyb_test/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v("/mysql-databases-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v('.tgz"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("s3_bucket")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3://your——name/"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If db_dir does not exist, create it：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数据库转储到文件中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Get all MySQL databases")]),s._v("\nmysqldump -u "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DB_USER")]),s._v(" -h "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DB_HOST")]),s._v(" -p"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DB_PASSWORD")]),s._v(" --no-create-db --databases wifidb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v("/wifidb-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v(".sql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dest_backup_file")]),s._v(" -C "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#压缩文件传到s3")]),s._v("\naws s3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dest_backup_file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${s3_bucket}")]),s._v("\naws s3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${s3_bucket}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("新建一个文件修改名字为"),a("code",[s._v("mysql_backups.sh")]),s._v(",上传到linux服务器，设置定时任务每天备份或者其他时间")]),s._v(" "),a("h3",{attrs:{id:"下载安装-cron"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载安装-cron"}},[s._v("#")]),s._v(" 下载安装 cron")]),s._v(" "),a("p",[s._v("linux下执行命令"),a("code",[s._v("sudo apt-get install cron")]),s._v("\ncorn 使用简要说明")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" # 启动状态\n service cron status\n # 启动\n service cron start\n # 关闭\n service cron stop\n \n # 查看当前任务计划\n crontab –l\n # 编辑\n crontab -e\n # 移除\n crontab –r\n -u user：用来设定某个用户的crontab服务；\n file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。\n 如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。\n -e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。\n -l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。\n -r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。\n -i：在删除用户的crontab文件时给确认提示。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("切换到安装路径"),a("code",[s._v("cd /var/spool/cron")]),s._v("\n设置定时任务"),a("code",[s._v("crontab -e")])]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("HELL=/bin/sh\nPATH=/sbin:/bin:/usr/sbin:/usr/bin\nMAILTO=you-email@163.com\n\n0 0 * * * /you-path/mysql_backups.sh\n\n# Example of job definition:\n# .---------------- minute (0 - 59)\n# | .------------- hour (0 - 23)\n# | | .---------- day of month (1 - 31)\n# | | | .------- month (1 - 12) OR jan,feb,mar,apr ...\n# | | | | .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat\n# | | | | |\n# * * * * * user-name command to be executed\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"这样就完成了定时备份mysql到s3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#这样就完成了定时备份mysql到s3"}},[s._v("#")]),s._v(" 这样就完成了定时备份mysql到s3")]),s._v(" "),a("h2",{attrs:{id:"扩展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩展"}},[s._v("#")]),s._v(" 扩展")]),s._v(" "),a("p",[s._v("从s3 上下载下来并还原到数据库")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this mysql download")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"you-user"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"you-password"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"you-db"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("date_format")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%a"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("db_dir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/fyb_test/download/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("s3_bucket")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3://you-name/mysql-databases-'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v('.tgz"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rm -rf $db_dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If db_dir does not exist, create it：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看 s3目录")]),s._v("\naws s3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${s3_bucket}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# aws s3 cp ${s3_bucket} $db_dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v("/mysql-databases-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v(".tgz "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/sbin\nmysql -u "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DB_USER")]),s._v(" -p"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DB_PASSWORD")]),s._v(" --default-character-set"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db_dir")]),s._v("/wifidb-"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$date_format")]),s._v(".sql\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("新建文件命名为"),a("code",[s._v("s3-mysql-download.sh")]),s._v(",需要还原的时候直接执行文件即可。")]),s._v(" "),a("p",[s._v("如果本文对您有所帮助，请打赏给我吧，我先送个你也红包往下看，你可以把扫到红包打赏个我哦！\n"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/trhsy/PicGo/img/hb.jpg",alt:"红包"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);